{"version":3,"sources":["../../src/lib/rule.js"],"names":[],"mappings":"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","file":"lib/rule.js","sourcesContent":["import {\n  getRequire, getDefault, getSource, replaceRequire, fromRe,\n} from '.'\n\nconst importRe = /^ *import(\\s+([^\\s,]+)\\s*,?)?(\\s*{(?:[^}]+)})?/\nconst re = new RegExp(`${importRe.source}${fromRe.source}`, 'gm')\n\n/**\n * Remaps `as` into `:`.\n * @param {string} namedSeg The segment containing named imports, e.g., `{ test, test2 as alias2 }`.\n */\nconst aliasesToDestructuring = (namedSeg) => {\n  const mm = namedSeg.replace(\n    /(\\s+)as(\\s+)/g,\n    (_, b, a) => {\n      const bb = b.split('\\n').length == 1 ? '' : b\n      return `${bb}:${a}`\n    })\n  return mm\n}\nconst replaceDefault = (def, replacement) => {\n  const d = def\n    .replace(',', '')\n    .replace(/([^\\s]+)/, replacement)\n  return d\n}\n\n/**\n * A rule to replace `import { method } from 'package'` statement.\n * @type {import('restream').Rule}\n */\nconst rule = {\n  re,\n  replacement(match, defSeg, defName, namedSeg, fromSeg, sd, ld) {\n    const realSrc = ld\n      ? this.markers.literals.map[ld]\n      : this.markers.strings.map[sd]\n    const [, quotes, src] = /([\"'`])(.+?)\\1/.exec(realSrc)\n    // a special case because regexes are replaced before literals\n    const s = src.replace(this.markers.regexes.regExp, (m, i) => {\n      const val = this.markers.regexes.map[i]\n      return val\n    })\n    const source = getSource(s, this.config)\n    const { t, ifES } = getDef(defSeg, defName, quotes, source)\n    const replacedNamed = getNamed(namedSeg, fromSeg, quotes, source, defName)\n    const res = [\n      t,\n      replacedNamed,\n      ifES,\n    ]\n      .filter(a => a)\n      .join('; ')\n    return `${res};`\n  },\n}\n\nconst getDef = (defSeg, defName, quotes, src) => {\n  if (!defSeg) return {}\n  const req = getRequire(quotes, src)\n  const { d, ifES } = getDefault(defName, req)\n  const s = replaceDefault(defSeg, d)\n  const t = `let${s}`\n  return { t, ifES }\n}\n\nconst getNamed = (namedSeg, fromSeg, quotes, src, defName) => {\n  if (!namedSeg) return null\n  const r = replaceRequire(fromSeg, quotes, src, defName)\n  const n = aliasesToDestructuring(namedSeg)\n  const s = `const${n}${r}`\n  return s\n}\n\nexport default rule\nexport { re }"]}